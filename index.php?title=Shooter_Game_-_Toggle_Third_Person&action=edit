<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" /><title>View source for Shooter Game - Toggle Third Person - Epic Wiki</title>
<meta name="generator" content="MediaWiki 1.22.2" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Epic Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.unrealengine.com/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Epic Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.vector&amp;only=styles&amp;skin=epic&amp;*" />
<link rel="stylesheet" href="/extensions/EpicVideoSystem/CSS/VideoSystem.css" />
<link rel="stylesheet" href="/skins/epic/resources/screen.css?303" media="screen" />
<link rel="stylesheet" href="/skins/epic/resources/epic.css?303" media="screen" />
<link rel="stylesheet" href="/skins/epic/resources/prettify.css?303" media="screen" />
<link rel="stylesheet" href="/skins/epic/resources/jquery.qtip.css?303" media="screen" /><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=epic&amp;*" />
<style>a:lang(ar),a:lang(ckb),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: my_wiki:resourceloader:filter:minify-css:7:07b6a8ccf3fd62e770f192d0a6f8e123 */</style>

<script src="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=epic&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Shooter_Game_-_Toggle_Third_Person","wgTitle":"Shooter Game - Toggle Third Person","wgCurRevisionId":15709,"wgRevisionId":0,"wgArticleId":2637,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Shooter_Game_-_Toggle_Third_Person","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"templateEditor":false,"templates":false,"preview":true,"previewDialog":false,"publish":true,"toc":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"epic","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"vector-simplesearch":1,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,
"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: my_wiki:resourceloader:filter:minify-js:7:2197af7670c41256853f340e275ede1b */
}</script>
<script src="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=skins.epic.extras.js%7Cskins.epic.fancybox.js%7Cskins.epic.js%7Cskins.epic.qtip.js%7Cskins.epic.slimscroll.js&amp;only=scripts&amp;skin=epic&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/epic/csshover.min.htc")}</style><![endif]--><script type="text/javascript">
var experimentID = false;
var cxApi = null;
var variation = 0;
var fancyTitle = "";
var CE_SNAPSHOT_NAME = document.getElementsByTagName("title")[0].innerHTML;
$(document).ready(function(){
	if(experimentID != false)
	{
		$(head).append('<script src="//www.google-analytics.com/cx/api.js?experiment=' + experimentID + '" />' + '</scr' + 'ipt>');
		HandleExperiment();
	}
	else
	{
		CE_SNAPSHOT_NAME = (fancyTitle != "" ? fancyTitle : document.getElementsByTagName("title")[0].innerHTML);
		setTimeout(function () {
			var a = document.createElement("script");
			var b = document.getElementsByTagName("script")[0];
			a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0028/4572.js?" + Math.floor(new Date().getTime() / 3600000);
			a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b)
		}, 1);	
	}
});
function HandleExperiment()
{
	CE_SNAPSHOT_NAME = (fancyTitle != "" ? fancyTitle : document.getElementsByTagName("title")[0].innerHTML);
	if(cxApi != null)
	{
		variation = cxApi.chooseVariation();
		cxApi.setChosenVariation(variation, experimentID);
		if(variation != cxApi.ORIGINAL_VARIATION && variation != cxApi.NO_CHOSEN_VARIATION && variation != cxApi.NOT_PARTICIPATING)
		{
			//var URL = document.location.href + (document.location.search != '' ? '&var=' : '?var=') + variation;
			ga('send', 'event', 'A/B', 'ID: ' + experimentID, 'Variation: ' + variation, {'nonInteraction': 1});
			//document.location.href = URL; 
			CE_SNAPSHOT_NAME = document.getElementsByTagName("title")[0].innerHTML + ' (variation ' + variation + ')';
			var test = "";
		}
		else
		{
			ga('send', 'event', 'A/B', 'ID: ' + experimentID, 'Variation: ' + variation, {'nonInteraction': 1});
		}
		ToggleExperimentContent(variation);
		setTimeout(function () {
			var a = document.createElement("script");
			var b = document.getElementsByTagName("script")[0];
			a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0028/4572.js?" + Math.floor(new Date().getTime() / 3600000);
			a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b)
		}, 1);
	}
	else
	{
		setTimeout("HandleExperiment()", 500);
	}
}

function ToggleExperimentContent(variation)
{
	$('.AB').hide();
	$('#variation_' + variation).show();
}
</script></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Shooter_Game_-_Toggle_Third_Person skin-epic action-edit vector-animateLayout">
		<!--<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>-->
		<!-- Google Tag Manager -->
		<noscript>
			<iframe src="//www.googletagmanager.com/ns.html?id=GTM-KWRD6D"
					height="0" width="0" style="display:none;visibility:hidden"></iframe>
		</noscript>
		<script>
		(function (w, d, s, l, i) {
		w[l] = w[l] || []; w[l].push({
		'gtm.start':
		new Date().getTime(), event: 'gtm.js'
		}); var f = d.getElementsByTagName(s)[0],
		j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
		'//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
		})(window, document, 'script', 'dataLayer', 'GTM-KWRD6D');</script>
		<!-- End Google Tag Manager -->
		<div id="webThree">
		<div id="head"></div>
		<div id="pagedefault">		
                    <div id="pagenav">
                        <div>
                            <!-- Start of Other language links -->
                            <!-- End of Other language links -->
                            <div class="homelink_container">
                                <a href="https://wiki.unrealengine.com" title="UE4 Wiki Home" class="homelink">HOME</a>
                            </div>
                        </div>
                        <div style="clear:both;">
                        </div>
                    </div>	
		<div id="mw-navigation" style="max-width:972px;margin:1em auto 0 auto;">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="jumplink" onclick="$('#sidebar').toggle();">
					Navigation
				</div>
				<div id="sidebar">
					<!-- Start of jump page links -->
					<div class="largetitle">
						Quick Links
					</div>
					<div class="arrowlist">
						<!-- End of jump page links -->
						<!-- Start of related page links -->
						<!-- End of related page links -->								
						<div id="mw-panel">
							<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Community' aria-labelledby='p-Community-label'>
	<h3 id='p-Community-label'>Community</h3>
	<div class="body">
		<ul>
			<li id="n-UE4-Games"><a href="/Category:Games">UE4 Games</a></li>
			<li id="n-Dev-Blogs"><a href="/Developer_Blogs">Dev Blogs</a></li>
			<li id="n-Dev-Livestreams"><a href="/Developer_Livestreams">Dev Livestreams</a></li>
			<li id="n-Code-Sharing-Hub"><a href="/GitHub_Sharing_Hub">Code Sharing Hub</a></li>
			<li id="n-UE-User-Groups"><a href="/User_Group_Map">UE User Groups</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Learning_Resources' aria-labelledby='p-Learning_Resources-label'>
	<h3 id='p-Learning_Resources-label'>Learning Resources</h3>
	<div class="body">
		<ul>
			<li id="n-Tutorials"><a href="/Category:Tutorials">Tutorials</a></li>
			<li id="n-Example-Projects"><a href="/Category:Example_Projects">Example Projects</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Software_and_Tools' aria-labelledby='p-Software_and_Tools-label'>
	<h3 id='p-Software_and_Tools-label'>Software and Tools</h3>
	<div class="body">
		<ul>
			<li id="n-Plug-ins"><a href="/Category:Plug-ins">Plug-ins</a></li>
			<li id="n-Art:-3D"><a href="/3D_Art_Resources">Art: 3D</a></li>
			<li id="n-Art:-2D"><a href="/2D_Art_Resources">Art: 2D</a></li>
			<li id="n-Audio"><a href="/Audio_Resources">Audio</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Modding' aria-labelledby='p-Modding-label'>
	<h3 id='p-Modding-label'>Modding</h3>
	<div class="body">
		<ul>
			<li id="n-Modding-Resources"><a href="/Category:Modding_Resources">Modding Resources</a></li>
			<li id="n-Moddable-Games"><a href="/Category:Moddable_Games">Moddable Games</a></li>
			<li id="n-Unreal-Tournament"><a href="/Category:Unreal_Tournament">Unreal Tournament</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Epic_Official' aria-labelledby='p-Epic_Official-label'>
	<h3 id='p-Epic_Official-label'>Epic Official</h3>
	<div class="body">
		<ul>
			<li id="n-Website"><a href="https://www.unrealengine.com" rel="nofollow">Website</a></li>
			<li id="n-Learning-Resources"><a href="https://docs.unrealengine.com/latest/INT/" rel="nofollow">Learning Resources</a></li>
			<li id="n-Forums"><a href="https://forums.unrealengine.com/" rel="nofollow">Forums</a></li>
			<li id="n-Blog"><a href="https://www.unrealengine.com/blog" rel="nofollow">Blog</a></li>
			<li id="n-YouTube"><a href="https://www.youtube.com/UnrealEngine" rel="nofollow">YouTube</a></li>
			<li id="n-Twitch"><a href="http://www.twitch.tv/unrealengine" rel="nofollow">Twitch</a></li>
			<li id="n-Twitter"><a href="https://twitter.com/UnrealEngine" rel="nofollow">Twitter</a></li>
			<li id="n-Facebook"><a href="https://www.facebook.com/UnrealEngine" rel="nofollow">Facebook</a></li>
			<li id="n-Instagram"><a href="https://instagram.com/unrealengine/" rel="nofollow">Instagram</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="/Special:WhatLinksHere/Shooter_Game_-_Toggle_Third_Person" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="/Special:RecentChangesLinked/Shooter_Game_-_Toggle_Third_Person" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="/index.php?title=Shooter_Game_-_Toggle_Third_Person&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
						</div>
					</div>
				</div>				
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="/Shooter_Game_-_Toggle_Third_Person"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="/index.php?title=Talk:Shooter_Game_-_Toggle_Third_Person&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="/Shooter_Game_-_Toggle_Third_Person" >View</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="/index.php?title=Shooter_Game_-_Toggle_Third_Person&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="/index.php?title=Shooter_Game_-_Toggle_Third_Person&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">History</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-createaccount"><a href="/index.php?title=Special:UserLogin&amp;returnto=Shooter+Game+-+Toggle+Third+Person&amp;returntoquery=action%3Dedit&amp;type=signup">Create account</a></li><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Shooter+Game+-+Toggle+Third+Person&amp;returntoquery=action%3Dedit" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>	</ul>
</div>
				</div>
			</div>
		</div>
		<div id="maincol">
		<div class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<!-- Start of crumbs links -->
			<div class="crumbs">
			<p>
							</p>
			</div>
			<!-- End of crumbs links -->
			<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for Shooter Game - Toggle Third Person</span></h1>
			<div id="bodyContent">
				<div id="contentSub">‚Üê <a href="/Shooter_Game_-_Toggle_Third_Person" title="Shooter Game - Toggle Third Person">Shooter Game - Toggle Third Person</a></div>
																<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="/index.php?title=Epic_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Epic Wiki:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">[[Category:Tutorials]]
[[Category:Code]]
[[Category:Community Created Content]]
{{Rating|Type=Article|Versions=4.4, 4.5, 4.6, 4.7, 4.8, 4.9}}
Original author: [https://forums.unrealengine.com/member.php?3827-GregBlast GregBlast]
__TOC__

=Overview=
Hello everyone !


In this tutorial I will show you how you can modify the '''Shooter Game''' sample from the '''Marketplace''' to allow toggling between first and third person views. The approach I will be using will be focused on sticking as much as possible to the original behaviour. By this I mean that I am not going to erase the use of a first person mesh when in first person view, but rather still keep its advantage and add a way to use the third person model and features only when needed.

In the tutorial I describe how I understood the code to tell you what it does and based on what. That's why it's not a quick short tutorial. If I have misunderstood something please do not hesitate to let me know.

[[File:ShooterGameThirdPersonView.png|thumb|none|940px|'''Third Person View''' in the '''Shooter Game''' sample from the '''Marketplace''']]

=Purpose=
The main purpose of this tutorial is of course to show you how to upgrade the original code to add third person view. However I will try to explain everything I did and how I found out it had to be done so that you can understand what you do instead of just copy-pasting the code.&lt;br />
The code sections won't include the methods names if they have been exposed in the description above them, so that you have to read them to know what to do. However I've marked the most relevant information in bold whenever applicable.
=Required=
For this tutorial you will need to download the '''Shooter Game''' sample from the '''Marketplace''' and create a project with it.

=Tutorial=
==Play-testing the game==
So to get started - and if you haven't already - you should first run the sample to see how everything behaves.

When alive you can see your character arms and weapon. If you look down you won't see any legs. That's because a special first person mesh has been given to the local player. As the local player is always in first person view you could think that the code has been written in that direction as well. And it has for some parts of it but fortunately not all. We'll get back on this later.

It's interesting to see what happens when you die. The camera stops moving and you can see a third person ragdoll fall to the floor. This means that at this point the game switches between first person and third person views. 

That is what got me started.
==Inside the code==
===Digging the grave (into the death code)===
From that point I searched for the handling of player death. Having a look at '''ShooterCharacter.cpp''' you will quickly find the '''OnDeath''' method which is called upon player death. Inside of that method you will notice the following commented piece of code (On line 341):
&lt;syntaxhighlight lang="cpp">
// switch back to 3rd person view
UpdatePawnMeshes();
&lt;/syntaxhighlight>
Let's then have a look at '''UpdatePawnMeshes'''. In that method you can see that another method determines which mesh should be visible: '''IsFirstPerson()'''. Its value is used with a call to '''SetOwnerNoSee''' on each mesh to show the first person mesh when in first person and show the third person mesh when in third person.

===Camera view state===
The '''IsFirstPerson()''' method defines the camera view state. If you have a look at its implementation you can see that it:
* returns '''false''' if the player is dead
* returns '''false''' for remote players
* returns '''true''' for local players

This is good enough for the purpose of the game as it is but you can see that it doesn't really talk about first or third person. It just assumes that local players will always be in first person unless they are dead (hence the third person switch on death). So next we're going to start by adding support for third person.
===Adding third person support===
Here's what we're going to do for this purpose:
* add a flag that will tell whether the player is using third person or not
* add support for this flag to be replicated so that the server will know if a player is using third person
* add default input support for this flag
* update IsFirstPerson to rely on this flag

====Preparing the header file====
Find the section of '''ShooterCharacter.h''' where the other flags are defined (e.g. below '''bWantsToFire''') and add a new boolean flag for third person toggle:
&lt;syntaxhighlight lang="cpp">
/** flag used to toggle third person camera view */
UPROPERTY(Transient, Replicated)
uint8 bIsThirdPerson;
&lt;/syntaxhighlight>

Next find the definition of '''SetRunning''' because we will be using a similar approach here. Below it add a definition for '''SetThirdPerson'''. This function will be responsible for actually toggling the camera view mode.
&lt;syntaxhighlight lang="cpp">
/** &lt;GB> [server + local] change third person state (server has to know that player is using third person) */
void SetThirdPerson(bool bNewThirdPerson);
&lt;/syntaxhighlight>

We'll need one last definition in the header file. At the very bottom of the code you'll see '''ServerSetRunning'''. Again we'll add a relatively similar method below it:
&lt;syntaxhighlight lang="cpp">
/** update first person state*/
UFUNCTION(reliable, server, WithValidation)
void ServerSetThirdPerson(bool bNewThirdPerson);
&lt;/syntaxhighlight>

====Adding the code====
Let's head to the code and add the implementation for our methods. Under '''UpdateRunSounds''' which is a good place for our purpose add the base code for the '''SetThirdPerson''' method (which will be similar to '''SetRunning'''):
&lt;syntaxhighlight lang="cpp">
void AShooterCharacter::SetThirdPerson(bool bNewThirdPerson)
{
	bIsThirdPerson = bNewThirdPerson;

	if (Role &lt; ROLE_Authority)
	{
		ServerSetThirdPerson(bNewThirdPerson);
	}
}
&lt;/syntaxhighlight>

Then similarily add the server validation and implementation:
&lt;syntaxhighlight lang="cpp">
bool AShooterCharacter::ServerSetThirdPerson_Validate(bool bNewThirdPerson)
{
	return true;
}

void AShooterCharacter::ServerSetThirdPerson_Implementation(bool bNewThirdPerson)
{
	SetThirdPerson(bNewThirdPerson);
}
&lt;/syntaxhighlight>

Alright this will take care of updating our flag. However we saw earlier that '''UpdatePawnMeshes''' is the method that toggles the visibility of the mesh to use. We should then call it from '''SetThirdPerson''' to make sure that our first person mesh gets hidden and our third person mesh becomes visible when using third person (and vice versa). Simply add a call to '''UpdatePawnMeshes();''' at the bottom of '''SetThirdPerson''':

&lt;syntaxhighlight lang="cpp">
void AShooterCharacter::SetThirdPerson(bool bNewThirdPerson)
{
	bIsThirdPerson = bNewThirdPerson;
	UpdatePawnMeshes();

	if (Role &lt; ROLE_Authority)
	{
		ServerSetThirdPerson(bNewThirdPerson);
	}
}
&lt;/syntaxhighlight>

Good. But still '''UpdatePawnMeshes''' relies on '''IsFirstPerson()''' to determine which mesh to show or hide. We thus still need to update it so it uses our flag to determine the camera view mode. Head to '''IsFirstPerson()''' and in addition to testing whether the player is alive and local, also check if the third person flag is not set:
&lt;syntaxhighlight lang="cpp">
return IsAlive() &amp;&amp; Controller &amp;&amp; Controller->IsLocalPlayerController() &amp;&amp; !bIsThirdPerson;
&lt;/syntaxhighlight>

Oh and last but not least lets not forget to initialize our flag in the constructor. Below '''bWantsToFire = false;''' do the same with our flag:
&lt;syntaxhighlight lang="cpp">
bIsThirdPerson = false;
&lt;/syntaxhighlight>
&lt;br/>
{{note|
You should probably declare a replication lifetime condition inside '''GetLifetimeReplicatedProps''' for the third person flag. I am unsure of how that works currently so I simply used the same as for '''bWantsToRun''':
&lt;syntaxhighlight lang="cpp">
DOREPLIFETIME_CONDITION(AShooterCharacter, bIsThirdPerson, COND_SkipOwner);
&lt;/syntaxhighlight>
}}

===Adding inputs===
This section will be pretty straightforward as it is assumed that you know how to add inputs to trigger some action. In '''ShooterCharacter.h''' below '''OnStopRunning''' add the following input declarations:
&lt;syntaxhighlight lang="cpp">
/** player pressed 3rd person action */
void OnThirdPerson();

/** player toggled 3rd person action */
void OnThirdPersonToggle();

/** player released 3rd person action */
void OnFirstPerson();
&lt;/syntaxhighlight>
In the code file '''ShooterCharacter.cpp''' add the third person inputs implementations below '''IsRunning''':
&lt;syntaxhighlight lang="cpp">
void AShooterCharacter::OnThirdPerson()
{
	AShooterPlayerController* MyPC = Cast&lt;AShooterPlayerController>(Controller);
	if (MyPC &amp;&amp; MyPC->IsGameInputAllowed())
	{
		SetThirdPerson(true);
	}
}

void AShooterCharacter::OnThirdPersonToggle()
{
	AShooterPlayerController* MyPC = Cast&lt;AShooterPlayerController>(Controller);
	if (MyPC &amp;&amp; MyPC->IsGameInputAllowed())
	{
		SetThirdPerson(!bIsThirdPerson);
	}
}

void AShooterCharacter::OnFirstPerson()
{
	SetThirdPerson(false);
}
&lt;/syntaxhighlight>

Now let's bind those actions in '''SetupPlayerInputComponent''':
&lt;syntaxhighlight lang="cpp">
InputComponent->BindAction("ThirdPerson", IE_Pressed, this, &amp;AShooterCharacter::OnThirdPerson);
InputComponent->BindAction("ThirdPersonToggle", IE_Pressed, this, &amp;AShooterCharacter::OnThirdPersonToggle);
InputComponent->BindAction("ThirdPerson", IE_Released, this, &amp;AShooterCharacter::OnFirstPerson);
&lt;/syntaxhighlight>

Finally lets edit '''Config/DefaultInput.ini''' to bind some default keys to those actions:
&lt;syntaxhighlight lang="ini">
+ActionMappings=(ActionName="ThirdPersonToggle",Key=G,bShift=False,bCtrl=False,bAlt=False,bCmd=False)
+ActionMappings=(ActionName="ThirdPerson",Key=F,bShift=False,bCtrl=False,bAlt=False,bCmd=False)
&lt;/syntaxhighlight>
You'll thus be able to toggle third person with '''G''' or press and release '''F''' to switch to/from third person.
==Taking a step back==
Alright now we have a functional logic to toggle third person. So let's see what we get when running this code. Well you will actually notice a few problems:
* in third person, the camera is inside of the player
* in third person, the weapon doesn't snap to the character's hands
* in third person, the right-click doesn't change bring iron sights or change the FOV

We'll start by taking care of the weapon.
==The weapon==
If you look at the code in '''ShooterWeapon.cpp''' you'll see that it also defines two meshes (one for 1st person and one for 3rd person) and that pretty much everywhere both of those are used in a rather generic manner so that you won't have to change much. For example:
* '''GetWeaponMesh''' already checks for '''IsFirstPerson()''' on the owning Pawn
* '''AttachMeshToPawn''' has a comment that says: ''For locally controller players we attach both weapons and let the bOnlyOwnerSee, bOwnerNoSee flags deal with visibility.''

However it doesn't snap to the player when in third person. The reason for that is simple: it's still the first person weapon mesh that is displayed in third person. And that last comment I quoted should set you on the correct path to handling this issue. You just need to swap model visibilities when switching between camera view modes just like it is done for the player model.

===Adding support for third person view in weapon code===
Let's define a new method in the '''ShooterWeapon''' header file that will be responsible for switching mesh visibility (below '''IsAttachedToPawn''' is fine):
&lt;syntaxhighlight lang="cpp">
/** update the meshes visibility */
void UpdateMeshes();
&lt;/syntaxhighlight>

The implementation in '''ShooterWeapon.cpp''' will simply check the pawn '''IsFirstPerson()''' and assign visibility based on that. We don't need to check if the pawn is a player and not a bot because '''IsFirstPerson()''' already checks if the pawn is locally controlled and returns false if not (i.e. third person for bots).
&lt;syntaxhighlight lang="cpp">
void AShooterWeapon::UpdateMeshes()
{
	if (MyPawn)
	{
		const bool bFirstPerson = MyPawn->IsFirstPerson();
		Mesh1P->SetOwnerNoSee(!bFirstPerson);
		Mesh3P->SetOwnerNoSee(bFirstPerson);
	}
}
&lt;/syntaxhighlight>

Now we need to call that method when we switch between camera view modes. So let's go back to '''ShooterCharacter.cpp''' and update '''UpdatePawnMeshes'''. We'll simply update the meshes visibility for the current weapon, if any:
&lt;syntaxhighlight lang="cpp">
if (CurrentWeapon)
{
	CurrentWeapon->UpdateMeshes();
}
&lt;/syntaxhighlight>

Now if you run this you will notice a little problem when switching weapon. The second weapon will not use that code we just wrote. Well that's because when it is created and added to the inventory it will use the first person mesh and since we only change the visibilities when we toggle the camera view mode it won't affect that other weapon at the time we equip it.

To fix that we can simply have a look at '''AShooterWeapon.OnEquip'''. At the bottom of the code you'll see that there is a check for locally controlled pawns. That is perfect for us to call our method. So add a call to '''UpdateMeshes();''' directly below the call to '''PlayerWeaponSound'''.

==Fixing the camera view in third person==
Now you could be tempted to think that this section will be the easiest. Well if you know how the engine works with the cameras you will probably have guessed that we're going to use a '''UCameraComponent''' to customize the third person view.

For those of you who (like me before making this) do not know how the engine handles the local player view location and rotation here's what you need to know for this tutorial:
* the '''PlayerCameraManager''' should be fed with a view target
* if the view target is a '''CameraActor''' or an '''Actor''' that contains a '''CameraComponent''', it will use its information only if '''bFindCameraComponentWhenViewTarget''' is set to '''true'''
* if the flag is set to '''false''' or the '''Actor''' doesn't have a '''CameraComponent''' the camera manager will use the Actor's location and rotation

That said we know what we have to do:
* add a '''CameraComponent''' to '''ShooterCharacter'''
* make sure '''bFindCameraComponentWhenViewTarget''' is disabled when using the first person mesh (so that the camera manager keeps using the first person mesh's location and rotation and not our third person camera)

===Adding the third person camera===
In the '''ShooterCharacter''' header file under '''Mesh1P''' add the following elements (camera + spring arm):
&lt;syntaxhighlight lang="cpp">
/** third person camera */
UPROPERTY(VisibleDefaultsOnly, Category=Camera)
UCameraComponent* ThirdPersonCamera;

/** an arm for the third person camera*/
UPROPERTY(VisibleDefaultsOnly, Category=Camera)
USpringArmComponent* ThirdPersonCameraArm;
&lt;/syntaxhighlight>

{{note|
In engine version '''4.5''' or older, use '''TSubobjectPtr&lt;>''' instead of regular pointers.
&lt;syntaxhighlight lang="cpp">
/** third person camera */
UPROPERTY(VisibleDefaultsOnly, Category=Camera)
TSubobjectPtr&lt;UCameraComponent> ThirdPersonCamera;
&lt;/syntaxhighlight>
}}

Initialize them in the constructor in the code file:

&lt;syntaxhighlight lang="cpp">
ThirdPersonCameraArm = ObjectInitializer.CreateDefaultSubobject&lt;USpringArmComponent>(this, TEXT("ThirdPersonCameraArm"));
ThirdPersonCameraArm->TargetOffset = FVector(0.f, 0.f, 0.f);
ThirdPersonCameraArm->SetRelativeLocation(FVector(-40.f, 0.f, 160.f));
ThirdPersonCameraArm->SetRelativeRotation(FRotator(-10.f, 0.f, 0.f));
ThirdPersonCameraArm->AttachTo(GetMesh()); // attach it to the third person mesh
ThirdPersonCameraArm->TargetArmLength = 200.f;
ThirdPersonCameraArm->bEnableCameraLag = false;
ThirdPersonCameraArm->bEnableCameraRotationLag = false;
ThirdPersonCameraArm->bUsePawnControlRotation= true; // let the controller handle the view rotation
ThirdPersonCameraArm->bInheritYaw = true;
ThirdPersonCameraArm->bInheritPitch = true;
ThirdPersonCameraArm->bInheritRoll = false;

ThirdPersonCamera = ObjectInitializer.CreateDefaultSubobject&lt;UCameraComponent>(this, TEXT("ThirdPersonCamera"));
ThirdPersonCamera->AttachTo(ThirdPersonCameraArm, USpringArmComponent::SocketName);
ThirdPersonCamera->bUsePawnControlRotation= false; // the arm is already doing the rotation
ThirdPersonCamera->FieldOfView = 90.f;
&lt;/syntaxhighlight>

{{note|
If you're using engine version '''4.5''' and older, the '''ObjectInitializer''' variable is replaced by '''PCIP'''.
&lt;syntaxhighlight lang="cpp">
ThirdPersonCamera = PCIP.CreateDefaultSubobject&lt;UCameraComponent>(this, TEXT("ThirdPersonCamera"));
&lt;/syntaxhighlight>

And the one instance of '''GetMesh()''' should be replaced with '''Mesh'''.
}}

{{note|
Also in engine version '''4.4''' or older, replace the two instances of '''bUsePawnControlRotation''' with '''bUseControllerViewRotation'''
}}

Now we need to deactivate the auto-search for camera functionality within our pawn when in '''first person'''. This will prevent the camera manager from using our '''third person camera''' as the point of view there. Remember it will use the '''first person mesh's''' location and rotation in that case. We can do this directly in '''UpdatePawnMeshes''' before updating the weapon meshes:
&lt;syntaxhighlight lang="cpp">
bFindCameraComponentWhenViewTarget = !bFirstPerson;
&lt;/syntaxhighlight>

{{note|
The player controller can also be used as the view target in some situations. You should set it to never search for a camera to make sure it never uses it (even if I'm not sure the camera manager would find the pawn camera for it).
&lt;syntaxhighlight lang="cpp">
if (Controller)
{
	Controller->bFindCameraComponentWhenViewTarget = false;
}
&lt;/syntaxhighlight>
}}

At this point if you test the game everything should be working as expected. Everything except a little detail we forgot: remember what the right-click does in first person ? Well it would be great to have at least a part of it functioning in third person too right ? I mean it should at least zoom in/out (change the FOV). Well let's fix that then.

===Fixing the zoom in/out (FOV change) on right-click===
The '''ShooterCharacter''' code file contains a method called '''OnCameraUpdate'''. This method is actually called by the custom camera manager called '''ShooterPlayerCameraManager''' when it updates the camera ('''UpdateCamera'''). The first thing to note about this method is that it gets called only in first person. That's how it is defined to work in '''ShooterPlayerCameraManager.UpdateCamera'''. Since '''OnCameraUpdate''' is meant to update the camera view for the pawn we should use it if we need specific actions to be done with the view in third person. So let's modify '''ShooterPlayerCameraManager.UpdateCamera''' to do what we need in third person.

The first part of the code calculates a new FOV (field of view). It does it only if the pawn returns '''true''' with '''IsFirstPerson()'''. If you still remember '''IsFirstPerson''' checks if the player is alive, local and now if he's not in third person (using our flag). Well let's just get rid of the check on our flag so it runs in third person too by checking alive and local manually.
Replace:
&lt;syntaxhighlight lang="cpp">
if (MyPawn &amp;&amp; MyPawn->IsFirstPerson())
&lt;/syntaxhighlight>
With:
&lt;syntaxhighlight lang="cpp">
if (MyPawn &amp;&amp; MyPawn->IsAlive() &amp;&amp; MyPawn->IsLocallyControlled())
&lt;/syntaxhighlight>

Do the same to call '''OnCameraUpdate''' on the pawn below the call to the base class.

Finally we need to handle the camera update differently for the third person. There we'll only change the FOV of our third person camera while in first person there is a bunch of code that calculates a new relative location and rotation for the fist person mesh, which we don't want.

In the '''ShooterCharacter''' header file add two new method declarations that take the same parameters as '''OnCameraUpdate'''. This is because they will be called by '''OnCameraUpdate''' using a branch on the camera view mode. Add those below '''TornOff();''':
&lt;syntaxhighlight lang="cpp">
/** camera update in first person */
void UpdateCameraFirstPerson(const FVector&amp; CameraLocation, const FRotator&amp; CameraRotation);

/** camera update in third person */
void UpdateCameraThirdPerson(const FVector&amp; CameraLocation, const FRotator&amp; CameraRotation);
&lt;/syntaxhighlight>

Now take all the code from '''OnCameraUpdate''' and use it as the implementation of '''UpdateCameraFirstPerson'''. Just a simple cut-paste from one method to the other ;). Then modify '''OnCameraUpdate''' so that it updates the first person view in first person and the third person view in third person:
&lt;syntaxhighlight lang="cpp">
if (IsFirstPerson())
{
	UpdateCameraFirstPerson(CameraLocation, CameraRotation);
}
else
{
	UpdateCameraThirdPerson(CameraLocation, CameraRotation);
}
&lt;/syntaxhighlight>

The implementation of '''UpdateCameraThirdPerson''' is not very complicated. Remember what the '''ShooterPlayerCameraManager''' did with the FOV ? It redefined it's own '''DefaultFOV''' value. So that's the one we'll be using for our third person camera. Simply assign the camera's FOV with the '''DefaultFOV''' from the camera manager like this:
&lt;syntaxhighlight lang="cpp">
void AShooterCharacter::UpdateCameraThirdPerson(const FVector&amp; CameraLocation, const FRotator&amp; CameraRotation)
{
	if (Controller &amp;&amp; ThirdPersonCamera)
	{
		ThirdPersonCamera->FieldOfView = Cast&lt;AShooterPlayerController>(Controller)->PlayerCameraManager->DefaultFOV;
	}
}
&lt;/syntaxhighlight>

Done! It should now be fully operational. Wait... I noticed one more strange thingy when playing. Yeah, the muzzle flash is not spawned at the correct location in third person. Well that's right. Again that part is based on mesh visibility but doesn't take the first person state into account directly.

==Fixing muzzle flash==
'''ShooterWeapon.SimulateWeaponFire''' is the one method in charge for that. A comment has been added to let us know that 2 effects are created because of a potential split screen game. In thate case both players are locally controlled so the shooter will see one effect and the other player will see the other one. Well lets define our possible cases:
* shooting in first person => show first person effect to shooter, show third person effect to other player
* shooting in third person => show third person effect to both players

So we'll first gather the result of '''IsFirstPerson()'''. Then we'll spawn the first person effect only in first person as nobody will need to see it in third person. It will be the shooting player's effect in first person. In third person it will become the other player's effect. The second effect will be the shooting player's effect when in third person and the other player's effect when in first person. Modify the code to look like this:
&lt;syntaxhighlight lang="cpp">
if( PlayerCon != NULL )
{
	const bool isFirstPerson = MyPawn->IsFirstPerson();

	// &lt;GB> In first person, this will be the Shooting player's effect
	if (isFirstPerson)
	{
		Mesh1P->GetSocketLocation(MuzzleAttachPoint);
		MuzzlePSC = UGameplayStatics::SpawnEmitterAttached(MuzzleFX, Mesh1P, MuzzleAttachPoint);
		MuzzlePSC->bOwnerNoSee = false;
		MuzzlePSC->bOnlyOwnerSee = true;
	}

	// &lt;GB> In third person, this will be the Other player's effect
	else
	{
		Mesh3P->GetSocketLocation(MuzzleAttachPoint);
		MuzzlePSC = UGameplayStatics::SpawnEmitterAttached(MuzzleFX, Mesh3P, MuzzleAttachPoint);
		MuzzlePSC->bOwnerNoSee = true;
		MuzzlePSC->bOnlyOwnerSee = false;
	}

	// &lt;GB> In first person, this will be the Other player's effect
	// &lt;GB> In third person, this will be the Shooting player's effect
	Mesh3P->GetSocketLocation(MuzzleAttachPoint);
	MuzzlePSCSecondary = UGameplayStatics::SpawnEmitterAttached(MuzzleFX, Mesh3P, MuzzleAttachPoint);
	MuzzlePSCSecondary->bOwnerNoSee = isFirstPerson;
	MuzzlePSCSecondary->bOnlyOwnerSee = !isFirstPerson;
}
&lt;/syntaxhighlight>

That should do it. Now you'll see your muzzle flash coming out of your gun correctly in third person view.
=Recap=
That's it for this tutorial. Of course do not hesitate to let me know if I made any mistakes or if some improvements could be added. I'll gladly reply to you and upgrade this.

Thanks for reading :).

[https://forums.unrealengine.com/member.php?3827-GregBlast GregBlast]
=Potential Issues=
As mentioned in the tutorial I am unsure about the replication part of the code. But as it doesn't really fall into the scope of this tutorial I'm not going to dig any further into it. Please feel free to let me know if what I did was incorrect.
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="/Template:Note" title="Template:Note">Template:Note</a> (<a href="/index.php?title=Template:Note&amp;action=edit" title="Template:Note">view source</a>) </li><li><a href="/Template:Rating" title="Template:Rating">Template:Rating</a> (<a href="/index.php?title=Template:Rating&amp;action=edit" title="Template:Rating">view source</a>) (protected)</li></ul></div><p id="mw-returnto">Return to <a href="/Shooter_Game_-_Toggle_Third_Person" title="Shooter Game - Toggle Third Person">Shooter Game - Toggle Third Person</a>.</p>
</div>												<div class="printfooter">
				Retrieved from "<a href="https://wiki.unrealengine.com/Shooter_Game_-_Toggle_Third_Person">https://wiki.unrealengine.com/Shooter_Game_-_Toggle_Third_Person</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		</div>
		</div>
		
		<div id="footer">
			<div id="brand">

			</div>
			<div id="legal">
				<div id="copyright">
					&copy; 2004-2015, Epic Games, Inc. All rights reserved. Unreal and its logo are Epic's trademarks or registered trademarks in the US and elsewhere.
				</div>
				<div id="terms">
					<a target="_blank" href="http://epicgames.com/tou">TERMS OF USE</a> | <a target="_blank" href="http://epicgames.com/privacynotice">PRIVACY POLICY</a>
				</div>
			</div>
		</div>
	</div>
		<!--<div id="footer" role="contentinfo">
										<ul id="footer-icons" class="noprint">
					<li id="footer-copyrightico">
						<div name="copyright">&#169; 2004-2014, Epic Games, Inc. All rights reserved. Epic Games, Unreal, Unreal Engine, Unreal Tournament, and their respective logos are Epic's trademarks or registered trademarks in the US and elsewhere.</div>
					</li>
					<li id="footer-termsofuseico">
						<div name="termsofuse"><a href="http://epicgames.com/tou" target="_blank">Terms of Use</a></div>
					</li>
					<li id="footer-privacynoticeico">
						<div name="privacynotice"><a href="http://epicgames.com/privacynotice" target="_blank">Privacy Policy</a></div>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>-->
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="/extensions/EpicSearchSystem/Javascript/Search.js?303"></script>
<script src="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=epic&amp;*"></script>
<!-- Served in 0.054 secs. -->		<img src="https://tracking.unrealengine.com/track.png" width="1" height="1">
		<!--<script type="text/javascript">
			setTimeout(function () {
				var a = document.createElement("script");
				var b = document.getElementsByTagName("script")[0];
				a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0028/4572.js?" + Math.floor(new Date().getTime() / 3600000);
				a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b)
			}, 1);
		</script>-->
	</body>
</html>

		